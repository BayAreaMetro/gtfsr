
---
title: "Getting GTFS Data and Mapping with GTFSr"
author: "Danton Noriega <danton@transloc.com>"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using GTFSr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Getting data from GTFS Transit Feeds

### 1. Get an GTFS API key

This package can get data from a user-specified URL and is also able to get GTFS data from the [TransitFeeds API](http://transitfeeds.com/api/). This vignette will focus on the case where GTFS data is extracted from the TransitFeed API. Below are the steps needed to get a API key (note: requires a GitHub account), including a YouTube (click the GIF to see the YouTube video) that visually guides you through the steps.

1. *Go to [http://transitfeeds.com/](http://transitfeeds.com/)*
2. *Click* "Sign in with GitHub" *in the top-right corner.*
	- If it is your first time visiting the site, it will ask you to sign in (and likely every time if you do not have cookies enabled).
3. *Once signed in, click your profile icon in the top-right and select* "API Keys" *from the drop-down menu.*
	- Your GitHub profile icon and username replaces "Sign in with GitHub".
4. *Fill in* "Enter a description" *and then click the* "Create Key" *button*.
5. *Copy your new API Key to your clipboard.*

[![vid-gif](https://j.gifs.com/kRNVY5.gif)](https://youtu.be/ufM67FoIMho)



### 2. Use `gtfsr` package to download feed list

First things first, load the `gtfsr` package and set your key to access the TransitFeeds API. This example also using the `dplyr` package to manage dataframes and `magrittr` for piping.

```{r setup, warning=TRUE, message=FALSE, echo=TRUE, eval=TRUE}
library(gtfsr)
library(magrittr)
library(dplyr)

set_api_key('2ec1ae29-b8c2-4a03-b96e-126d585233f9') # input your API key here
```

### Getting full list available GTFS feeds

With a valid API key loaded, you can easily get the full list of GTFS feeds using the `get_feedlist` function. What we care most about are the feed GTFS data urls contained in column `url_d` of the feed list. We output the first 10 GTFS data urls after getting the full feed list.

```{r feedlist, warning=TRUE, message=TRUE, echo=TRUE, eval=TRUE}
feedlist_df <- get_feedlist() # create a dataframe of all feeds
feedlist_df %>% select(url_d) %>% slice(1:10) # show urls to GTFS data from first 5 feeds
```

If we want only the data for a specific location (or locations), we can get then search the locations feed and find the IDs of interest. Assume we are interested in getting all the GTFS data from *Australian* feeds (i.e. we search .


```{r get_locations, warning=TRUE, message=TRUE, echo=TRUE, eval=TRUE}
locations_df <- get_locations()
#################################################################################
# LEFT OFF HERE ----------------------------------------------------------
#################################################################################
## get australian feeds
subset_df <- locations_df %>%
    filter(grepl('australia', t, ignore.case = TRUE)) %>% # filter out locations with "australia" in name
    select(id, t)
subset_df
aussie_ids <- subset_df %>% select(id)
aussie_ids
```